# Guardrails - Enterprise Security Scanning for GitHub Copilot

## Overview

Guardrails is an enterprise-grade security scanning solution that detects and flags insecure coding patterns, ensures compliance with industry standards, and provides AI-assisted code review capabilities. It integrates seamlessly with GitHub to automatically scan pull requests and provide actionable feedback.

## Key Features

### ðŸ”’ Secure Coding Guardrails
- **Hardcoded Secrets Detection**: Identifies API keys, passwords, tokens, and credentials
- **SQL Injection Detection**: Flags SQL injection vulnerabilities from string interpolation
- **Insecure Deserialization**: Detects unsafe `pickle.loads()`, `yaml.load()`, etc.
- **Unsafe Code Execution**: Identifies `eval()`, `exec()`, `os.system()` usage
- **Weak Cryptography**: Detects MD5, SHA1, and other weak algorithms
- **Additional Checks**: File operations, random generation, logging, dependency issues

### ðŸ¤– AI-Assisted Code Review
- **Copilot Detection**: Identifies code generated by GitHub Copilot
- **AI-Specific Guardrails**: Stricter analysis for AI-generated code
- **Intelligent Suggestions**: Provides context-aware fix recommendations with explanations
- **Hybrid Analysis**: Combines static analysis with LLM-based contextual reasoning

### ðŸ“‹ Enterprise Compliance
- **OWASP Top 10 Mapping**: All violations mapped to OWASP categories
- **CWE Tracking**: Cross-references Common Weakness Enumeration
- **Industry-Specific Rulesets**:
  - Banking (PCI DSS)
  - Healthcare (HIPAA)
  - Government (FedRAMP, FISMA)
  - Telecommunications

### ðŸŽ¯ Policy-Based Enforcement
- **Advisory Mode**: Informational comments only
- **Warning Mode**: PR annotations with alerts
- **Blocking Mode**: Prevents merge until issues resolved (with override capability)
- **Repository-Level Overrides**: Customize policies per repository or organization

### ðŸ“Š Audit & Reporting
- **Comprehensive Logging**: Track all violations, actions, and resolutions
- **Exportable Reports**: JSON/CSV export for compliance teams
- **Trend Analysis**: Monitor violation patterns over time
- **Copilot Risk Hotspots**: Identify high-risk AI-generated code areas

### ðŸ”Œ Extensibility
- **Plugin Architecture**: Add custom rules and analyzers
- **Rule Packs**: Pre-built or custom collections of rules
- **Custom Analyzers**: Integrate domain-specific security checks
- **Language Support**: Framework for adding new programming languages

## Architecture

### Backend (FastAPI)
- **Code Analyzer**: Parses diffs and runs security checks
- **Policy Engine**: Enforces organization policies
- **Audit Logger**: Tracks all events for compliance
- **AI Reviewer**: Generates intelligent suggestions
- **Plugin System**: Supports extensible rules and compliance frameworks

### GitHub App (TypeScript)
- **PR Webhook Handler**: Automatically scans PRs on open/update
- **Comment Formatter**: Posts detailed, actionable feedback
- **Status Checks**: Sets commit status for merge gating
- **Override Support**: Allows manual policy overrides when needed

## Installation & Setup

### Backend Setup

```bash
cd backend
pip install -r requirements.txt
python main.py
```

Environment variables:
- `HOST`: Server host (default: 0.0.0.0)
- `PORT`: Server port (default: 8000)
- `DEBUG`: Enable debug mode (default: false)
- `OPENAI_API_KEY`: Optional OpenAI API key for AI suggestions

### GitHub App Setup

```bash
cd guardrails-github-app
npm install
npm run build
npm start
```

Environment variables:
- `BACKEND_URL`: Backend API URL
- `APP_ID`: GitHub App ID
- `PRIVATE_KEY`: GitHub App private key
- `WEBHOOK_SECRET`: Webhook secret from GitHub

## API Documentation

### Analyze Code
```bash
POST /api/analyze
{
  "repo_name": "owner/repo",
  "pr_number": 123,
  "commit_hash": "abc123",
  "files": {
    "path/to/file.py": "diff content..."
  },
  "copilot_generated_files": ["path/to/file.py"],
  "override_token": "token_if_overriding"
}
```

### Get Rules
```bash
GET /api/rules
```

### Policy Management
```bash
GET /api/policies
POST /api/policies

# Create/manage policies for repositories
```

### Audit & Reporting
```bash
GET /api/audit?repo=owner/repo&days=7
POST /api/audit/export
GET /api/insights?days=30
```

### Compliance Rules
```bash
GET /api/compliance/industries
GET /api/compliance/rules/{industry}
POST /api/compliance/check
```

### Configuration
```bash
GET /api/config/rulesets
GET /api/config/ruleset/{name}
POST /api/config/ruleset
```

## Configuration

### Repository Policy File

Create `.guardrails/policy.yaml` in your repository:

```yaml
enforcement_mode: warning  # advisory, warning, or blocking
block_on_critical: true
block_on_high: false

enable_security_checks: true
enable_compliance_checks: true
enable_quality_checks: false

allowed_licenses:
  - MIT
  - Apache-2.0
  - BSD-3-Clause

rules:
  SEC-001:
    enabled: true
    severity: critical
```

### Custom Rule Packs

Define custom rulesets in YAML:

```yaml
name: custom-ruleset
version: "1.0.0"
description: "Custom security rules for our organization"

rules:
  - rule_id: CUSTOM-001
    name: "Custom Security Check"
    enabled: true
    severity: high
    category: security
    description: "Custom rule description"
    cwe_id: CWE-xxx
    tags: [custom, security]
```

## Rule Categories

### Security (SEC-001 to SEC-010)
- Hardcoded secrets
- SQL injection
- Insecure deserialization
- Unsafe code execution
- Weak cryptography
- Insecure headers
- Unsafe file operations
- Insecure randomness
- Logging sensitive data
- Insecure dependencies

### AI-Generated Code (AI-001 to AI-002)
- Incomplete implementations
- Risky patterns in AI code

### Compliance (COMP-001)
- Unresolved security TODOs

### License & IP (LICENSE-001, IP-001 to IP-002)
- Incompatible licenses
- Code derivatives

### Performance (PERF-001)
- Performance issues

## Enforcement Modes

### Advisory â„¹ï¸
- Only informational comments
- No merge blocking
- Best for monitoring compliance

### Warning âš ï¸
- Detailed PR comments
- Status checks but not blocking
- Recommended for most teams

### Blocking ðŸš«
- Prevents merge on violations
- Requires manual override
- Best for critical security policies

### Override Mechanism
```bash
# Request override
curl -X POST http://localhost:8000/api/override \
  -H "Content-Type: application/json" \
  -d '{"repo_name": "owner/repo", "reason": "Business justification"}'

# Response includes override_token
# Include token in next analysis request to bypass block
```

## AI-Assisted Features

### Intelligent Suggestions
When OpenAI API is configured, Guardrails provides:
- Context-aware code fixes
- Security best practices
- Explanations of vulnerabilities
- Links to security resources

### Copilot Detection
Automatically identifies code likely generated by Copilot:
- Generic TODO comments
- Placeholder patterns
- Incomplete implementations

Stricter guardrails applied to AI-generated code.

## Audit & Compliance

### Audit Log Format
```json
{
  "event_id": "uuid",
  "timestamp": "2024-01-27T10:00:00",
  "repo_name": "owner/repo",
  "pr_number": 123,
  "violation_count": 5,
  "critical_count": 2,
  "high_count": 1,
  "enforcement_action": "warning",
  "blocked": false
}
```

### Export Options
```bash
# Export as JSON
curl -X POST http://localhost:8000/api/audit/export \
  -d '{"format": "json"}' -H "Content-Type: application/json"

# Export as CSV
curl -X POST http://localhost:8000/api/audit/export \
  -d '{"format": "csv"}' -H "Content-Type: application/json"
```

### Organization Insights
```bash
GET /api/insights?days=30
```

Returns:
- Total scans and violations
- Most common violations
- Trends over time
- Copilot risk hotspots
- PR blocking statistics

## Plugin Development

### Create Custom Rule Plugin

```python
from app.plugins import RulePlugin
from app.models import Violation, SeverityLevel, RuleCategory

class CustomSecurityRule(RulePlugin):
    @property
    def rule_id(self) -> str:
        return "CUSTOM-001"
    
    @property
    def name(self) -> str:
        return "Custom Security Check"
    
    @property
    def supported_languages(self) -> list:
        return ["python", "javascript"]
    
    def analyze(self, code: str, file_path: str) -> list:
        violations = []
        # Your analysis logic here
        return violations
    
    def is_applicable(self, file_path: str) -> bool:
        return file_path.endswith(('.py', '.js'))
```

### Register Plugin
```python
from app.plugins import register_rule_plugin

plugin = CustomSecurityRule()
register_rule_plugin(plugin)
```

## Performance Optimization

### Scan Caching
Results cached for 60 minutes to avoid duplicate analysis of same commit.

### Asynchronous Processing
Large PRs automatically chunked for parallel analysis:
- Prioritizes security-critical files first
- Processes in parallel batches
- Reduces scan time for 100+ file PRs

### Rate Limiting
Default: 100 requests per minute per IP
- Prevents abuse
- Configurable per deployment

## Deployment

### Docker Deployment
```bash
docker-compose up
```

### Production Checklist
- [ ] Set `DEBUG=false`
- [ ] Configure `OPENAI_API_KEY` for AI features
- [ ] Set strong `BACKEND_SECRET`
- [ ] Configure log rotation
- [ ] Enable audit logging export
- [ ] Set up monitoring/alerting
- [ ] Configure backup of audit logs
- [ ] Test policy overrides
- [ ] Verify GitHub webhook delivery

### Kubernetes Deployment
See deployment manifests in `k8s/` directory for Helm charts and YAML configurations.

## Security Considerations

### Data Privacy
- No source code retained after analysis
- Configurable data residency
- Secure token handling
- HIPAA/SOC2 compliant logging

### Authentication
- GitHub App authentication
- Optional API key authentication for direct API calls
- HTTPS only in production

### Audit Trail
- Complete audit logging for compliance
- Immutable event logs
- Exportable for compliance audits

## Troubleshooting

### AI Suggestions Not Working
- Verify `OPENAI_API_KEY` is set
- Check API quota and rate limits
- Fallback to rule-based suggestions active

### PRs Not Being Scanned
- Verify GitHub App is installed on repository
- Check webhook delivery in GitHub App settings
- Review backend logs for errors

### High False Positive Rate
- Customize rules via `.guardrails/policy.yaml`
- Disable low-priority checks
- Adjust severity levels

## Contributing

Contributions welcome! See [CONTRIBUTING.md](CONTRIBUTING.md)

## License

See [LICENSE](LICENSE)

## Support

- Issues: GitHub Issues
- Documentation: Full API docs at `/docs` (Swagger)
- Security Issues: security@guardrails.ai
