# Guardrails GitHub App

A Probot GitHub App that integrates with the Guardrails backend to scan pull requests for security violations and posts detailed findings as PR comments.

## Features

- **Automatic PR Scanning:** Triggers on PR open/update
- **Detailed Comments:** Posts violations grouped by severity
- **CWE/OWASP Mapping:** Links to security standards
- **Copilot Detection:** Flags AI-generated code
- **Suggested Fixes:** Provides remediation guidance

## Quick Start

### Prerequisites
- Node.js 18+
- Guardrails backend running at `http://localhost:8000`

### Local Development

```bash
npm install
npm run build
npm start
```

## Setup GitHub App

Visit https://github.com/settings/apps/new and configure:

1. **Webhook URL:** https://your-domain/webhook (or use Smee for local)
2. **Permissions:** 
   - Contents: Read
   - Pull requests: Write
   - Issues: Write
   - Metadata: Read
3. **Events:** pull_request, issues
4. **Generate Private Key** and save `.pem` file

### Environment Variables

```bash
export APP_ID=your-app-id
export PRIVATE_KEY="$(cat your-key.pem)"
export WEBHOOK_SECRET=your-webhook-secret
export BACKEND_URL=http://localhost:8000
```

## How It Works

1. PR opened/updated ‚Üí GitHub webhook triggered
2. App fetches changed files and diffs
3. Backend analyzes code for violations
4. App posts formatted PR comment with results

## PR Comment Example

```
## üîç Guardrails Security Scan

**Summary:**
- üî¥ Critical: 1 | üü† High: 2

### üî¥ CRITICAL Issues

<details>
<summary><b>Hardcoded API Key</b> (SEC-001) in app.py:42</summary>

**Issue:** API Key exposed in source code

**Code:**
```
api_key = "sk-123456"
```

**CWE:** CWE-798
**OWASP:** A02:2021 ‚Äì Cryptographic Failures

</details>

---
*Generated by Guardrails Security Scanner*
```

## Docker

```bash
docker build -t guardrails-github-app .
docker run -e APP_ID=xxx -e PRIVATE_KEY=xxx \
  -e WEBHOOK_SECRET=xxx \
  -e BACKEND_URL=https://backend.example.com \
  -p 3000:3000 guardrails-github-app
```

## API Integration

Calls backend at `POST /api/analyze` with PR diffs.

See [Backend README](../backend/README.md) for API details.

## Configuration

**Supported Languages:** Python, JavaScript/TypeScript, Java, C#, Go, Ruby, PHP, SQL, and more.

## Troubleshooting

**Backend connection error:**
- Check `BACKEND_URL` environment variable
- Verify backend is running: `curl http://localhost:8000/health`

**No PR comments:**
- Check webhook deliveries in GitHub App settings
- Verify app has write permissions
- Check app logs

## Contributing

Improvements welcome! See [Main README](../README.md) for more.

## License

ISC ¬© 2026 0210-ai
